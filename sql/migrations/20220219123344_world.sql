DROP PROCEDURE IF EXISTS add_migration;
delimiter ??
CREATE PROCEDURE `add_migration`()
BEGIN
DECLARE v INT DEFAULT 1;
SET v = (SELECT COUNT(*) FROM `migrations` WHERE `id`='20220219123344');
IF v=0 THEN
INSERT INTO `migrations` VALUES ('20220219123344');
-- Add your query below.


SET @POPULARITY_CONTEST_WINNER_DARNASSUS_EVENT = 110;
SET @POPULARITY_CONTEST_WINNER_IRONFORGE_EVENT = 111;
SET @POPULARITY_CONTEST_WINNER_STORMWIND_EVENT = 112;
SET @POPULARITY_CONTEST_WINNER_ORGRIMMAR_EVENT = 113;
SET @POPULARITY_CONTEST_WINNER_THUNDERBLUFF_EVENT = 114;
SET @POPULARITY_CONTEST_WINNER_UNDERCITY_EVENT = 115;
SET @POPULARITY_CONTEST_WINNER_DARNASSUS_GGUID = 0;
SET @POPULARITY_CONTEST_WINNER_IRONFORGE_GGUID = 0;
SET @POPULARITY_CONTEST_WINNER_STORMWIND_GGUID = 0;
SET @POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID = 20591;
SET @POPULARITY_CONTEST_WINNER_THUNDERBLUFF_GGUID = 0;
SET @POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID = 13787;
SET @POPULARITY_CONTEST_PEDDLE_CGUID = 2354;

-- Peddle.
UPDATE `creature_template` SET `unit_flags`=32768 WHERE `entry`=16075;

-- Some Gameobject corrections.
UPDATE `gameobject_template` SET `faction`=114 WHERE `entry` IN (181014,181015,181016,181017,181018,181019,181020,181021,181022,181024,181025,181027,181055,181086,181060,181087);
UPDATE `gameobject_template` SET `faction`=0, `patch`=7 WHERE `entry`=181073;

-- Undercity Contest Winning Peddle.
INSERT INTO `creature` (`guid`, `id`, `id2`, `id3`, `id4`, `map`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecsmin`, `spawntimesecsmax`, `wander_distance`, `health_percent`, `mana_percent`, `movement_type`, `spawn_flags`, `visibility_mod`, `patch_min`, `patch_max`) VALUES
    (@POPULARITY_CONTEST_PEDDLE_CGUID+1, 16075, 0, 0, 0, 0, 7562, 1296.95, -59.9998, 1.20428, 120, 120, 0, 100, 100, 0, 0, 0, 7, 10);

INSERT INTO `game_event_creature` (`guid`, `event`) VALUES (@POPULARITY_CONTEST_PEDDLE_CGUID+1, @POPULARITY_CONTEST_WINNER_UNDERCITY_EVENT);

-- Undercity Contest Winning Gameobjects.
INSERT INTO `gameobject` (`guid`, `id`, `map`, `position_x`, `position_y`, `position_z`, `orientation`, `rotation0`, `rotation1`, `rotation2`, `rotation3`, `spawntimesecsmin`, `spawntimesecsmax`, `animprogress`, `state`, `spawn_flags`, `visibility_mod`, `patch_min`, `patch_max`) VALUES
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+1, 181016, 0, 1291.54, 331.683, -60.0831, 1.93731, 0, 0, 0.824125, 0.566408, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+2, 181016, 0, 1298, 329.864, -60.0831, 0.767944, 0, 0, 0.374606, 0.927184, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+3, 181024, 0, 1307.84, 377.899, -51.5738, 1.29154, 0, 0, 0.601814, 0.798636, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+4, 181024, 0, 1307.93, 378.982, -53.309, 1.25664, 0, 0, 0.587785, 0.809017, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+5, 181025, 0, 1275.68, 315.589, -58.2578, 1.02974, 0, 0, 0.492423, 0.870356, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+6, 181025, 0, 1283.47, 344.265, -58.0373, 0.942477, 0, 0, 0.45399, 0.891007, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+7, 181025, 0, 1302.94, 308.317, -58.2572, 1.46608, 0, 0, 0.66913, 0.743145, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+8, 181025, 0, 1310.57, 336.817, -58.488, 1.72787, 0, 0, 0.760406, 0.649449, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+9, 181086, 0, 1294.49, 330.321, -60.0831, 1.29154, 0, 0, 0.601814, 0.798636, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+10, 181087, 0, 1290.13, 332.09, -60.0831, 1.32645, 0, 0, 0.615661, 0.788011, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+11, 181087, 0, 1290.74, 333.091, -60.0831, 1.44862, 0, 0, 0.66262, 0.748956, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+12, 181087, 0, 1291.58, 333.534, -60.0831, 2.19911, 0, 0, 0.891006, 0.453991, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+13, 181087, 0, 1292.6, 333.716, -60.0831, 4.15388, 0, 0, -0.874619, 0.48481, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+14, 181087, 0, 1298.34, 331.26, -60.0831, 2.58308, 0, 0, 0.961261, 0.27564, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+15, 181087, 0, 1299.3, 330.869, -60.0831, 6.14356, 0, 0, -0.0697556, 0.997564, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+16, 181087, 0, 1300.02, 329.854, -60.0831, 0.90757, 0, 0, 0.438371, 0.898794, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+17, 181087, 0, 1300.22, 326.837, -60.0831, 2.93214, 0, 0, 0.994521, 0.104536, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+18, 181087, 0, 1300.31, 328.454, -60.0831, 4.17134, 0, 0, -0.870356, 0.492424, 120, 120, 0, 1, 0, 0, 7, 10);

INSERT INTO `game_event_gameobject` SELECT gameobject.guid, @POPULARITY_CONTEST_WINNER_UNDERCITY_EVENT FROM `gameobject` WHERE gameobject.guid BETWEEN @POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+1 AND @POPULARITY_CONTEST_WINNER_UNDERCITY_GGUID+18;

-- Orgrimmar Contest Winning Gameobjects (I did this already last year but some stuff is missing, thats why i delete the old objects).
DELETE FROM `gameobject` WHERE `guid` IN (SELECT `guid` FROM `game_event_gameobject` WHERE `event`=@POPULARITY_CONTEST_WINNER_ORGRIMMAR_EVENT);

INSERT INTO `gameobject` (`guid`, `id`, `map`, `position_x`, `position_y`, `position_z`, `orientation`, `rotation0`, `rotation1`, `rotation2`, `rotation3`, `spawntimesecsmin`, `spawntimesecsmax`, `animprogress`, `state`, `spawn_flags`, `visibility_mod`, `patch_min`, `patch_max`) VALUES
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+1, 181016, 1, 1917.01, -4138.25, 40.3796, 4.41568, 0, 0, -0.803857, 0.594823, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+2, 181016, 1, 1924.46, -4137.94, 40.3811, 4.99164, 0, 0, -0.601814, 0.798636, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+3, 181021, 1, 1381.49, -4369.8, 52.8347, 3.28124, 0, 0, -0.997563, 0.0697661, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+4, 181021, 1, 1484.87, -4416.72, 53.1904, 0.104719, 0, 0, 0.0523357, 0.99863, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+5, 181021, 1, 1659.82, -4329.04, 75.2346, 2.68781, 0, 0, 0.97437, 0.224951, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+6, 181021, 1, 1661.55, -4344.48, 75.2458, 3.7001, 0, 0, -0.961261, 0.27564, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+7, 181021, 1, 1672.88, -4320.48, 74.9852, 1.64061, 0, 0, 0.731353, 0.681999, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+8, 181021, 1, 1685.85, -4327.43, 74.8583, 0.698131, 0, 0, 0.34202, 0.939693, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+9, 181021, 1, 1687.43, -4340.11, 74.9505, 5.79449, 0, 0, -0.241921, 0.970296, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+10, 181021, 1, 1706.77, -3929.71, 71.8858, 5.2709, 0, 0, -0.484809, 0.87462, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+11, 181025, 1, 1910.07, -4126.43, 42.8192, 5.09636, 0, 0, -0.559193, 0.829038, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+12, 181025, 1, 1916.17, -4252.84, 40.584, 4.72984, 0, 0, -0.700909, 0.713251, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+13, 181025, 1, 1930, -4125.44, 42.9065, 4.57276, 0, 0, -0.754709, 0.656059, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+14, 181025, 1, 1941.25, -4251.97, 39.8368, 4.60767, 0, 0, -0.743144, 0.669131, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+15, 181086, 1, 1920.9, -4138.83, 40.3446, 4.76475, 0, 0, -0.688354, 0.725374, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+16, 181087, 1, 1915.15, -4137.65, 40.4083, 5.37562, 0, 0, -0.438371, 0.898794, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+17, 181087, 1, 1915.54, -4139.13, 40.4075, 6.14356, 0, 0, -0.0697556, 0.997564, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+18, 181087, 1, 1916.38, -4140.26, 40.4081, 0.90757, 0, 0, 0.438371, 0.898794, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+19, 181087, 1, 1917.35, -4140.83, 40.4098, 4.17134, 0, 0, -0.870356, 0.492424, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+20, 181087, 1, 1924.86, -4139.68, 40.4048, 2.93214, 0, 0, 0.994521, 0.104536, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+21, 181087, 1, 1925.43, -4140.79, 40.3955, 1.32645, 0, 0, 0.615661, 0.788011, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+22, 181087, 1, 1926.18, -4141.52, 40.3869, 1.44862, 0, 0, 0.66262, 0.748956, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+23, 181087, 1, 1927.15, -4141.59, 40.3858, 2.19911, 0, 0, 0.891006, 0.453991, 120, 120, 0, 1, 0, 0, 7, 10),
    (@POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+24, 181087, 1, 1928.18, -4141.17, 40.3907, 4.15388, 0, 0, -0.874619, 0.48481, 120, 120, 0, 1, 0, 0, 7, 10);

INSERT INTO `game_event_gameobject` SELECT gameobject.guid, @POPULARITY_CONTEST_WINNER_ORGRIMMAR_EVENT FROM `gameobject` WHERE gameobject.guid BETWEEN @POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+1 AND @POPULARITY_CONTEST_WINNER_ORGRIMMAR_GGUID+24;


-- End of migration.
END IF;
END??
delimiter ; 
CALL add_migration();
DROP PROCEDURE IF EXISTS add_migration;
